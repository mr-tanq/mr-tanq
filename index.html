<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Listening Mirror</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
body{background:#0b0c0f;color:#e6e6e6;padding:24px}
h1{font-size:42px;font-weight:700;margin-bottom:18px}
.tabs{display:flex;gap:10px;margin:18px 0 26px 0}
.tab{padding:10px 18px;border-radius:999px;background:#17191f;color:#aaa;cursor:pointer;transition:.25s}
.tab.active{background:#2a2d36;color:#fff}
.card{background:linear-gradient(145deg,#16181f,#0f1116);border-radius:18px;padding:18px;margin-bottom:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.track{display:flex;align-items:center;gap:14px;padding:10px 12px;border-radius:14px;transition:.2s}
.track:hover{background:#1b1e25}
.art{width:58px;height:58px;border-radius:12px;background:#222;object-fit:cover}
.meta{flex:1;min-width:0}
.artist{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.title{font-size:14px;color:#b5b5b5;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.time{font-size:13px;color:#8c8c8c}
.nowbox{display:flex;align-items:center;gap:18px}
.nowart{width:120px;height:120px;border-radius:16px;object-fit:cover}
.eq{width:18px;height:14px;display:inline-flex;gap:2px;align-items:flex-end;opacity:.9}
.eq i{width:3px;height:6px;background:#aef;animation:eq 900ms ease-in-out infinite;border-radius:2px}
.eq i:nth-child(2){animation-delay:120ms;height:9px}
.eq i:nth-child(3){animation-delay:240ms;height:7px}
.eq i:nth-child(4){animation-delay:360ms;height:10px}
@keyframes eq{0%,100%{transform:scaleY(.55);opacity:.75}50%{transform:scaleY(1.2);opacity:1}}
.hidden{display:none}
.sectiontitle{font-size:22px;font-weight:700;margin-bottom:14px}
</style>
</head>

<body>

<h1>Listening Mirror</h1>

<div class="tabs">
<div class="tab active" id="tab-now">Now</div>
<div class="tab" id="tab-today">Today</div>
<div class="tab" id="tab-week">Week</div>
</div>

<div id="now" class="card">
<div class="sectiontitle">Now Playing</div>
<div class="nowbox">
<img id="nowart" class="nowart">
<div class="meta">
<div class="artist" id="nowartist"></div>
<div class="title" id="nowtitle"></div>
<div class="eq"><i></i><i></i><i></i><i></i></div>
</div>
</div>
</div>

<div id="today" class="card hidden">
<div class="sectiontitle">Today</div>
<div id="todaylist"></div>
</div>

<div id="week" class="card hidden">
<div class="sectiontitle">Top Tracks (7 days)</div>
<div id="weeklist"></div>
</div>

<script>
const worker="https://i.errtanq9.workers.dev/"

const tabs={
now:document.getElementById("tab-now"),
today:document.getElementById("tab-today"),
week:document.getElementById("tab-week")
}

function activate(name){
for(let t in tabs){tabs[t].classList.remove("active");document.getElementById(t).classList.add("hidden")}
tabs[name].classList.add("active")
document.getElementById(name).classList.remove("hidden")
}

tabs.now.onclick=()=>activate("now")
tabs.today.onclick=()=>activate("today")
tabs.week.onclick=()=>activate("week")

function timeFormat(ts){
const d=new Date(ts*1000)
return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})
}

async function loadNow(){
const r=await fetch(worker+"/now")
const j=await r.json()
document.getElementById("nowartist").textContent=j.artist
document.getElementById("nowtitle").textContent=j.title
document.getElementById("nowart").src=j.art
}

async function loadToday(){
const r=await fetch(worker+"/today")
const j=await r.json()
const list=document.getElementById("todaylist")
list.innerHTML=""
j.slice(0,10).forEach(t=>{
const row=document.createElement("div")
row.className="track"
row.innerHTML=`
<img class="art" src="${t.art}">
<div class="meta">
<div class="artist">${t.artist}</div>
<div class="title">${t.title}</div>
</div>
<div class="time">${timeFormat(t.ts)}</div>
`
list.appendChild(row)
})
}

async function loadWeek(){
const r=await fetch(worker+"/toptracks")
const j=await r.json()
const list=document.getElementById("weeklist")
list.innerHTML=""
j.slice(0,10).forEach(t=>{
const row=document.createElement("div")
row.className="track"
row.innerHTML=`
<img class="art" src="${t.art}">
<div class="meta">
<div class="artist">${t.artist}</div>
<div class="title">${t.title}</div>
</div>
`
list.appendChild(row)
})
}

loadNow()
loadToday()
loadWeek()
setInterval(loadNow,20000)
</script>

</body>
</html>
